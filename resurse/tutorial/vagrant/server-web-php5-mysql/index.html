<!DOCTYPE html> <html lang="ro"> <head> <title>Alexandru Coman | Vagrant - Server web (PHP5 & MySQL)</title> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="author" content="Alexandru Coman"> <link rel="canonical" href="/resurse/tutorial/vagrant/server-web-php5-mysql/"> <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" type="text/css"> <link href="/assets/css/main.css" rel="stylesheet" type="text/css"> <!-- Custom Fonts --> <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"> <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"> <link href="//fonts.googleapis.com/css?family=Montserrat:400,700,400italic,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"> <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries --> <!-- WARNING: Respond.js doesn't work if you view the page via file:// --> <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script> <![endif]--> <link rel="shortcut icon" type="image/x-icon" href="/assets/img/favicon.ico"> <meta name="apple-mobile-web-app-capable" content="yes"> <link rel="apple-touch-icon" sizes="36x36" href="/img/web-app/icon-36p.png"> <link rel="apple-touch-icon" sizes="48x48" href="/img/web-app/icon-48p.png"> <link rel="apple-touch-icon" sizes="72x72" href="/img/web-app/icon-72p.png"> <link rel="apple-touch-icon" sizes="96x96" href="/img/web-app/icon-96p.png"> <link rel="apple-touch-icon" sizes="144x144" href="/img/web-app/icon-144p.png"> <link rel="apple-touch-icon" sizes="192x192" href="/img/web-app/icon-192p.png"> <link rel="manifest" href="/manifest.json"> <!-- Syntax highlight in post pages --> <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/default.min.css"> </head> <body id="page-top"> <section id="post" class="post container content-section"> <div class="row"> <header id="post-header" class="text-center"> <h1>Vagrant - Server web (PHP5 & MySQL)</h1> </header> <div class="terminal col-md-8 col-md-offset-2"> <p class="m-b-md"> <span class="text-muted">~ $ cd <a href="/resurse">resurse</a>/<a href="/resurse/tutorial">tutorial</a>/<a href="/resurse/tutorial/vagrant">vagrant</a></span><br> <span class="text-muted">~ $ cat Vagrant - Server web (PHP5 & MySQL)</span> </p> </div> <article class="col-md-8 col-md-offset-2"> <div id="post-content" class="post-content text-justify"> </p> <h2 id="resurse-necesare">Resurse necesare</h2> <p>Pentru pregătirea mediului de execuție o să folosim utilitarul <a href="https://www.vagrantup.com/">Vagrant</a> și hypervisorul <a href="https://www.virtualbox.org/">VirtualBox</a>.</p> <p><a href="https://www.virtualbox.org/">VirtualBox</a> este o aplicație ce ne permite să virtualizăm o mașină fizică (un computer). Cu ajutorul său, putem să creăm o mașină virtuală după specificațiile oferite de noi, ce va conține un sistem de operare izolat de sistemul de operare al mașinii gazdă. Mai multe detalii pot fi găsite în tutorialul <a href="/resurse/tutorial/virtualbox/notiuni-introductive/">VirtualBox - noțiuni introductive</a>.</p> <p><a href="https://www.vagrantup.com/">Vagrant</a> este un sistem de configurare, distribuție și virtualizare a mediilor de lucru, dezvoltare și publicare. El permite prin o mulțime de aplicații externe, configurarea, aprovizionarea și distribuirea ușoară a mașinilor virtuale, cu scopul de a standardiza și ușura pregătirea unui mediu pentru dezvoltarea sau publicarea unei aplicații sau a obține accesul la unelte necesare lucrului, disponibile doar pe anumite sisteme de operare. Mai multe detalii pot fi găsite în tutorialul <a href="/resurse/tutorial/vagrant/notiuni-introductive/">Vagrant - Noțiuni introductive</a>.</p> <h2 id="pregătirea-mediului-de-lucru">Pregătirea mediului de lucru</h2> <p>Pentru pregătirea mediului de execuție o să avem nevoie de un fișier de configurare (fișierul <code class="highlighter-rouge">Vagrantfile</code>) și o serie de scripturi care să se ocupe de pregătirea mediului de execuție.</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c"># Alegem un director de lucru cât mai convenabil</span>
~ <span class="nv">$ </span>mkdir -p ~/tehnologii-web/tuxy-bot
~ <span class="nv">$ </span><span class="nb">cd</span> ~/tehnologii-web/tuxy-bot

<span class="c"># Facem o copie locală a depozitului de cod labs</span>
~ <span class="nv">$ </span>git clone https://github.com/alexcoman/labs

<span class="c"># Copiem din depozitul de cod fișierele de interes</span>
~ <span class="nv">$ </span>cp -r labs/web/unelte/vagrant/webserver/. .

<span class="c"># Ștergem depozitul de cod</span>
~ <span class="nv">$ </span>rm -rf labs
</code></pre></div> <p>Acum în directorul curent ar trebui să avem următoarea structură de directoare:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>.
├── provision
│   ├── nginx
│   │   ├── conf.d
│   │   │   └── sauce.conf
│   │   ├── fastcgi_params
│   │   ├── koi-utf
│   │   ├── koi-win
│   │   ├── mime.types
│   │   ├── nginx.conf
│   │   ├── scgi_params
│   │   ├── uwsgi_params
│   │   └── win-utf
│   ├── nginx.sh
│   ├── php.ini
│   └── vagrant.sh
├── README.md
└── Vagrantfile
</code></pre></div> <h3 id="fișierul-de-configurare">Fișierul de configurare</h3> <p>Înainte de a trece la pasul următor, va trebui să verificăm dacă fișierul de configurare <code class="highlighter-rouge">Vagrantfile</code> conține specificațiile pe care ni le dorim (de exemplu: numărul de procesoare, adresa ip etc).</p> <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">api_version</span> <span class="o">=</span> <span class="s1">'2'</span>
<span class="n">provider</span>    <span class="o">=</span> <span class="s1">'virtualbox'</span>
<span class="n">box</span>         <span class="o">=</span> <span class="s1">'hashicorp/precise64'</span>
<span class="n">hostname</span>    <span class="o">=</span> <span class="s1">'webserver'</span>
<span class="n">ip_address</span>  <span class="o">=</span> <span class="s1">'192.168.50.210'</span>
<span class="n">ram</span>         <span class="o">=</span> <span class="s1">'1024'</span>
<span class="n">cpus</span>        <span class="o">=</span> <span class="s1">'2'</span>

<span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="n">api_version</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"webserver"</span> <span class="k">do</span> <span class="o">|</span><span class="n">webserver</span><span class="o">|</span>
    <span class="k">end</span>

    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="n">box</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">host_name</span> <span class="o">=</span> <span class="n">hostname</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="ss">:private_network</span><span class="p">,</span> <span class="ss">ip: </span><span class="n">ip_address</span>

    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="ss">:virtualbox</span> <span class="k">do</span> <span class="o">|</span><span class="n">virtualbox</span><span class="o">|</span>
        <span class="n">virtualbox</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="n">hostname</span>
        <span class="n">virtualbox</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="n">ram</span>
        <span class="n">virtualbox</span><span class="p">.</span><span class="nf">cpus</span> <span class="o">=</span> <span class="n">cpus</span>
    <span class="k">end</span>

    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span> <span class="k">do</span> <span class="o">|</span><span class="n">setup</span><span class="o">|</span>
        <span class="n">setup</span><span class="p">.</span><span class="nf">path</span> <span class="o">=</span> <span class="s2">"provision/vagrant.sh"</span>
        <span class="n">setup</span><span class="p">.</span><span class="nf">privileged</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="k">end</span>

    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span> <span class="p">,</span><span class="ss">run: </span><span class="s2">"always"</span> <span class="k">do</span> <span class="o">|</span><span class="n">setup</span><span class="o">|</span>
        <span class="n">setup</span><span class="p">.</span><span class="nf">path</span> <span class="o">=</span> <span class="s2">"provision/nginx.sh"</span>
        <span class="n">setup</span><span class="p">.</span><span class="nf">privileged</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div> <h2 id="pregătirea-mediului-de-execuție">Pregătirea mediului de execuție</h2> <p>După ce am descărcat și modificat după caz toate fișierele de care avem nevoie, putem să pregătim mediul de execuție pentru aplicația dorită.</p> <h3 id="crearea-mașinii-virtuale">Crearea mașinii virtuale</h3> <p>Pentru a începe pregătirea mediului de execuție putem folosi comanda <code class="highlighter-rouge">vagrant up</code>:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>~ <span class="nv">$ </span>vagrant up

<span class="gp">==&gt; </span>webserver: Adăugăm sursa de pachete pentru PHP5.
<span class="gp">==&gt; </span>webserver: + <span class="nb">echo</span> <span class="s1">'Adăugăm sursa de pachete pentru nginx.'</span>
<span class="gp">==&gt; </span>webserver: Adăugăm opțiunile dorite pentru serverul de mysql.
<span class="gp">==&gt; </span>webserver: Instalăm pachetele dorite
<span class="gp">==&gt; </span>webserver: Configurăm serverul web.
<span class="gp">==&gt; </span>webserver: Deschidem portul 80.
<span class="gp">==&gt; </span>webserver: Repornim serviciile.
<span class="gp">==&gt; </span>webserver: Am terminat.
</code></pre></div> <h3 id="interacțiunea-cu-mediul-de-execuție">Interacțiunea cu mediul de execuție</h3> <p>După ce execuția comenzii anterioare s-a finalizat putem observa că au fost create două directoare noi:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>.
├── .log
│   ├── nginx-access.log
│   ├── nginx-error.log
│   └── php-access.log
└── .www
</code></pre></div> <ul> <li><code class="highlighter-rouge">.www</code> care va conține aplicația dumneavoastră</li> <li><code class="highlighter-rouge">.logs</code> care va conține fișierele de log</li> </ul> <h4 id="verificăm-dacă-serverul-web-este-funțional">Verificăm dacă serverul web este funțional</h4> <p>Pentru a ușura interacțiunea cu serverul web putem adăuga o nouă intrare în fișierul <code class="highlighter-rouge">/etc/hosts</code>.</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo <span class="nb">echo</span> <span class="s2">"192.168.50.210	webserver.local"</span> &gt;&gt; /etc/hosts
</code></pre></div> <p>Pregătim un script PHP de test:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>~ <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"&lt;?php echo 'OK.'; ?&gt;"</span> &gt; .www/index.php
~ <span class="nv">$ </span>chmod 755 .www/index.php
</code></pre></div> <p>Trimitem o cerere HTTP către serverul web.</p> <div class="highlighter-rouge"><pre class="highlight"><code>~ $ wget http://webserver.local/
Resolving webserver.local (webserver.local)... 192.168.50.210
Connecting to webserver.local (webserver.local)|192.168.50.210|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/html]
Saving to: ‘index.html’
(488 KB/s) - ‘index.html’ saved [3]
</code></pre></div> <p>Verificăm dacă răspunsul este cel așteptat.</p> <div class="highlighter-rouge"><pre class="highlight"><code>~ $ cat index.html
OK.
</code></pre></div> </div> <footer> <ul class="list-inline social-buttons"> </ul> </footer> </article> </div> </section> <footer id="footer" class="footer"> <div class="container text-center"> <p> Ultima actualizare: 16 mai 2017 <a itemprop="license" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"title="Conținut licențiat sub termenii Attribution-NonCommercial-ShareAlike 4.0 International">CC</a><br /> <a href="/" title="Spre situl Web al titularului laboratorului Alexandru Coman">Alexandru Coman</a> </p> </div> </footer> <script src="//code.jquery.com/jquery-1.11.3.min.js"></script> <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script> <script>hljs.initHighlightingOnLoad();</script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-99139394-1', 'auto'); ga('send', 'pageview'); </script> <script src="/assets/js/rrssb.min.js"></script> </body> </html>
